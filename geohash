#!/bin/sh -e

[ "$2" -gt -30 ] && { date -R > /dev/null 2>&1 && y='-d -1day' || y='-v -1d'; }
command -v GET > /dev/null 2>&1 || GET() { fetch -qo- "$@" || wget -qO- "$@"; }
command -v md5 > /dev/null 2>&1 || md5() { md5sum | cut -c 1-32; }

echo -n $(date +%F)-$(GET http://irc.peeron.com/xkcd/map/data/$(date $y +%Y/%m\
/%d)) | md5 | tr a-f A-F | sed "s/.\{16\}/.&LgPp/g" | dc -e "[$2]Sg[$1]Sg16i" -
