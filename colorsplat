#!/usr/bin/python

import sys
import re
import gtk
import getopt

colorpat = re.compile('#[0-9a-fA-F]+')
selcolor = None
short = False

def pick_color(name, title):
    sel = gtk.ColorSelectionDialog('colorsplat: %s' % title)
    sel.colorsel.set_current_color(gtk.gdk.color_parse(name))

    def ok(widget):
        global selcolor, short
        cur = sel.colorsel.get_current_color()
        if short:
            comp = [(int(c)>>8) for c in (cur.red, cur.green, cur.blue)]
            selcolor = '#%02x%02x%02x' % tuple(comp)
        else:
            selcolor = cur.to_string()

    def cancel(widget):
        global selcolor
        selcolor = name

    sel.ok_button.connect('clicked', ok)
    sel.ok_button.connect('clicked', gtk.main_quit)
    sel.cancel_button.connect('clicked', cancel)
    sel.cancel_button.connect('clicked', gtk.main_quit)

    sel.show()
    gtk.main()
    sel.hide()

    return selcolor

if __name__ == '__main__':
    opts, args = getopt.getopt(sys.argv[1:], '2')
    for o, a in opts:
        if o == '-2':
            short = True
    if args:
        for name in args:
            print pick_color(name, name)
    else:
        for line in sys.stdin:
            print colorpat.sub(lambda m: pick_color(m.group(0), line), line),
