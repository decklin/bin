#!/bin/sh

banner_url=http://www.kernel.org/kdist/finger_banner
twitter_url=http://api.twitter.com/1/statuses/update.xml
flavors='stable mainline'

account=$1
tree=$2
state_dir=$HOME/var/lk/$account
creds=$HOME/lib/lk/$account

temp=`mktemp` || exit 1
curl -s $banner_url | grep "\<$tree\>" > $temp

for i in $flavors; do
    x="$(awk "/latest $i/{print\"$i:\",\$NF;exit}" $temp \
        | confer -i $state_dir/$i)"
    if [ "$x" ]; then
        curlicue -f $creds -- \
            -s -d "status=$(urlencode "$x")" "$twitter_url" >/dev/null
    fi
done

rm -f $temp
